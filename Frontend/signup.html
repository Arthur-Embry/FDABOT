<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FDA BOT Signup</title>
    <link rel="icon" type="image/png"
        href="https://3efzdwq8ie.ufs.sh/f/20eZA3KF6RiYKEKtRElJmx9UthcObSAC3EV70TIedz1nBMko">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet" />
    <!-- Add marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        outfit: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    },
                    keyframes: {
                        bounce: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        },
                        fadeIn: {
                            from: { opacity: '0' },
                            to: { opacity: '1' }
                        }
                    },
                    animation: {
                        bounce: 'bounce 1s infinite',
                        fadeIn: 'fadeIn 0.3s ease'
                    }
                }
            }
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('darkMode') === 'true') {
                document.documentElement.classList.add('dark');
            }
        });
    </script>
</head>

<body
    class="font-outfit bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-200 min-h-screen flex flex-col antialiased">
    <header
        class="bg-white dark:bg-slate-800 shadow-sm border-b border-gray-200 dark:border-slate-700 py-3 px-4 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://3efzdwq8ie.ufs.sh/f/20eZA3KF6RiYKEKtRElJmx9UthcObSAC3EV70TIedz1nBMko" alt="Logo"
                    class="h-16 w-16 dark:hidden">
                <img src="https://3efzdwq8ie.ufs.sh/f/20eZA3KF6RiYVcNcIBwLBwyhETPnYK1sQIfzSatrAU23ol40" alt="Logo"
                    class="h-16 w-16 hidden dark:block">
                <h1 id="brand-title" class="text-xl font-semibold tracking-tight">FDA BOT</h1>
            </div>
            <div>
                <button onclick="toggleDarkMode()"
                    class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fa-solid fa-moon dark:hidden"></i>
                    <i class="fa-solid fa-sun hidden dark:block"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-1 flex items-center justify-center p-6">
        <div
            class="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-gray-100 dark:border-slate-700 p-6 w-full max-w-md animate-fadeIn">
            <!-- Form Title -->
            <div class="mb-6">
                <h2 id="form-title" class="text-2xl font-semibold text-center">Sign In to FDA BOT</h2>
            </div>

            <!-- Form Toggle Links -->
            <div class="flex justify-center space-x-4 mb-6">
                <button id="toggle-signin" class="text-primary-600 dark:text-primary-400 font-medium">Sign In</button>
                <button id="toggle-signup" class="text-gray-400 dark:text-gray-500 font-medium">Sign Up</button>
            </div>

            <!-- Social Auth -->
            <div class="mb-4">
                <button id="google-auth"
                    class="w-full flex items-center justify-center border border-gray-300 dark:border-slate-600 rounded-lg p-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                    <i class="fab fa-google mr-2"></i>Continue with Google
                </button>
            </div>

            <!-- Divider -->
            <div class="flex items-center mb-4">
                <hr class="flex-grow border-gray-300 dark:border-slate-600" />
                <span class="mx-2 text-gray-500 dark:text-gray-400 text-sm">or</span>
                <hr class="flex-grow border-gray-300 dark:border-slate-600" />
            </div>

            <!-- Sign In Form -->
            <form id="signin-form" class="space-y-4">
                <div>
                    <input type="email" id="signin-email" placeholder="Email"
                        class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400"
                        required>
                </div>
                <div>
                    <input type="password" id="signin-password" placeholder="Password"
                        class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400"
                        required>
                </div>
                <div>
                    <button type="submit"
                        class="w-full bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-lg transition-colors shadow-sm">
                        Sign In
                    </button>
                </div>
                <div class="text-center">
                    <a href="#" id="forgot-password-link"
                        class="text-sm text-primary-600 dark:text-primary-400 hover:underline">
                        Forgot Password?
                    </a>
                </div>
                <div id="signin-message" class="text-sm text-center text-red-600 dark:text-red-400"></div>
            </form>

            <!-- Sign Up Form -->
            <form id="signup-form" class="space-y-4 hidden">
                <div>
                    <input type="email" id="signup-email" placeholder="Email"
                        class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400"
                        required>
                </div>
                <div>
                    <input type="password" id="signup-password" placeholder="Password"
                        class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400"
                        required>
                </div>
                <div>
                    <input type="password" id="signup-password-confirm" placeholder="Confirm Password"
                        class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400"
                        required>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="terms-checkbox" class="mr-2 text-primary-600 focus:ring-primary-500">
                    <label for="terms-checkbox" class="text-sm text-gray-600 dark:text-gray-400">
                        I agree to the <a href="#"
                            class="text-primary-600 dark:text-primary-400 hover:underline">Terms</a> and
                        <a href="#" class="text-primary-600 dark:text-primary-400 hover:underline">Privacy Policy</a>
                    </label>
                </div>
                <div>
                    <button type="submit"
                        class="w-full bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-lg transition-colors shadow-sm">
                        Create Account
                    </button>
                </div>
                <div id="signup-message" class="text-sm text-center text-red-600 dark:text-red-400"></div>
            </form>

            <!-- Forgot Password Form -->
            <form id="forgot-form" class="space-y-4 hidden">
                <div>
                    <input type="email" id="forgot-email" placeholder="Enter your email"
                        class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400"
                        required>
                </div>
                <div>
                    <button type="submit"
                        class="w-full bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-lg transition-colors shadow-sm">
                        Send Reset Link
                    </button>
                </div>
                <div id="forgot-message" class="text-sm text-center text-red-600 dark:text-red-400"></div>
                <div class="text-center">
                    <a href="#" id="back-to-signin"
                        class="text-sm text-primary-600 dark:text-primary-400 hover:underline">
                        Back to Sign In
                    </a>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-700 py-4 mt-auto">
        <div class="max-w-7xl mx-auto text-center text-gray-600 dark:text-gray-400">
            <p>&copy; 2025 <span id="footer-brand">FDA BOT</span>. All rights reserved.</p>
        </div>
    </footer>

    <!-- PocketBase and App Script -->
    <script src="https://unpkg.com/pocketbase@0.21.3/dist/pocketbase.umd.js"></script>
    <script>
        // Define brand variable
        const brandName = "FDA BOT";

        // Set brand name in header, form title, and footer on DOM load
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('brand-title').textContent = brandName;
            document.getElementById('form-title').textContent = 'Sign In to ' + brandName;
            document.getElementById('footer-brand').textContent = brandName;
        });

        // Define PocketBase URL and initialize client
        const POCKETBASE_URL = 'https://pb-fda-channel.operatorai.com';

        const pb = new PocketBase(POCKETBASE_URL);

        // Form Elements
        const toggleSignin = document.getElementById('toggle-signin');
        const toggleSignup = document.getElementById('toggle-signup');
        const signinForm = document.getElementById('signin-form');
        const signupForm = document.getElementById('signup-form');
        const forgotForm = document.getElementById('forgot-form');
        const formTitle = document.getElementById('form-title');
        const forgotLink = document.getElementById('forgot-password-link');
        const backToSignin = document.getElementById('back-to-signin');

        // Message Elements
        const signinMessage = document.getElementById('signin-message');
        const signupMessage = document.getElementById('signup-message');
        const forgotMessage = document.getElementById('forgot-message');

        // Toggle Form Views
        toggleSignin.addEventListener('click', () => {
            formTitle.textContent = 'Sign In to ' + brandName;
            signinForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            forgotForm.classList.add('hidden');
            toggleSignin.classList.replace('text-gray-400', 'text-primary-600');
            toggleSignin.classList.replace('dark:text-gray-500', 'dark:text-primary-400');
            toggleSignup.classList.replace('text-primary-600', 'text-gray-400');
            toggleSignup.classList.replace('dark:text-primary-400', 'dark:text-gray-500');
            clearMessages();
        });

        toggleSignup.addEventListener('click', () => {
            formTitle.textContent = 'Sign Up for ' + brandName;
            signupForm.classList.remove('hidden');
            signinForm.classList.add('hidden');
            forgotForm.classList.add('hidden');
            toggleSignup.classList.replace('text-gray-400', 'text-primary-600');
            toggleSignup.classList.replace('dark:text-gray-500', 'dark:text-primary-400');
            toggleSignin.classList.replace('text-primary-600', 'text-gray-400');
            toggleSignin.classList.replace('dark:text-primary-400', 'dark:text-gray-500');
            clearMessages();
        });

        forgotLink.addEventListener('click', (e) => {
            e.preventDefault();
            formTitle.textContent = 'Reset your ' + brandName + ' Password';
            forgotForm.classList.remove('hidden');
            signinForm.classList.add('hidden');
            signupForm.classList.add('hidden');
            clearMessages();
        });

        backToSignin.addEventListener('click', (e) => {
            e.preventDefault();
            formTitle.textContent = 'Sign In to ' + brandName;
            signinForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            forgotForm.classList.add('hidden');
            clearMessages();
        });

        function clearMessages() {
            signinMessage.textContent = '';
            signupMessage.textContent = '';
            forgotMessage.textContent = '';
        }

        // Helper for button loading state
        function setLoading(button, isLoading) {
            if (isLoading) {
                button.disabled = true;
                button.textContent = 'Loading...';
            } else {
                button.disabled = false;
                if (button.id === 'google-auth') {
                    button.innerHTML = '<i class="fab fa-google mr-2"></i>Continue with Google';
                } else if (button.closest('form').id === 'signin-form') {
                    button.textContent = 'Sign In';
                } else if (button.closest('form').id === 'signup-form') {
                    button.textContent = 'Create Account';
                } else if (button.closest('form').id === 'forgot-form') {
                    button.textContent = 'Send Reset Link';
                }
            }
        }

        // Google SSO Authentication (only provider)
        document.getElementById('google-auth').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                setLoading(e.target, true);
                const authData = await pb.collection('users').authWithOAuth2({ provider: 'google' });
                document.cookie = `pb_auth=${pb.authStore.token}; path=/; max-age=604800; secure; samesite=Strict`;
                window.location.href = '/landing';
            } catch (err) {
                console.error('Google auth failed:', err);
                signinMessage.textContent = err.message;
            } finally {
                setLoading(e.target, false);
            }
        });

        // Sign In Form Submission
        signinForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearMessages();
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;
            const submitButton = signinForm.querySelector('button[type="submit"]');
            try {
                setLoading(submitButton, true);
                const authData = await pb.collection('users').authWithPassword(email, password);
                if (!authData.record.verified) {
                    await pb.collection('users').requestVerification(email);
                    signinMessage.textContent = 'Please verify your email. Verification link sent.';
                    pb.authStore.clear();
                    setLoading(submitButton, false);
                    return;
                }
                document.cookie = `pb_auth=${pb.authStore.token}; path=/; max-age=604800; secure; samesite=Strict`;
                signinMessage.textContent = 'Sign in successful! Redirecting...';
                setTimeout(() => window.location.href = '/landing', 1000);
            } catch (err) {
                console.error('Sign in error:', err);
                signinMessage.textContent = err.message;
            } finally {
                setLoading(submitButton, false);
            }
        });

        // Sign Up Form Submission
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearMessages();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const passwordConfirm = document.getElementById('signup-password-confirm').value;
            const termsChecked = document.getElementById('terms-checkbox').checked;
            const submitButton = signupForm.querySelector('button[type="submit"]');

            if (password !== passwordConfirm) {
                signupMessage.textContent = 'Passwords do not match.';
                return;
            }
            if (!termsChecked) {
                signupMessage.textContent = 'Please accept the terms and conditions.';
                return;
            }

            try {
                setLoading(submitButton, true);
                const data = { email, password, passwordConfirm, emailVisibility: true };
                await pb.collection('users').create(data);
                await pb.collection('users').requestVerification(email);
                signupMessage.textContent = 'Account created! Please verify your email.';
            } catch (err) {
                console.error('Sign up error:', err);
                if (err.data && err.data.data && err.data.data.email && err.data.data.email.code === 'validation_invalid_not_unique') {
                    signupMessage.textContent = 'This email address is already registered.';
                } else {
                    signupMessage.textContent = err.message;
                }
            } finally {
                setLoading(submitButton, false);
            }
        });

        // Forgot Password Form Submission
        forgotForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearMessages();
            const email = document.getElementById('forgot-email').value;
            const submitButton = forgotForm.querySelector('button[type="submit"]');
            try {
                setLoading(submitButton, true);
                await pb.collection('users').requestPasswordReset(email);
                forgotMessage.textContent = 'Password reset link sent to your email.';
            } catch (err) {
                console.error('Forgot password error:', err);
                forgotMessage.textContent = err.message;
            } finally {
                setLoading(submitButton, false);
            }
        });
    </script>
</body>

</html>